<launch>

  <arg name="map_file" default="$(find turtlebot3_navigation)/maps/map.yaml"/>
  <arg name="path_file" default="$(find agv_explore)/map/turtlebot3/turtlebot3_gazebo_world_existing_path.yaml"/>
  <arg name="use_existing_path" default="false"/>
  <arg name="initial_pose_x" default="-2.0"/>
  <arg name="initial_pose_y" default="-0.5"/>
  <arg name="initial_pose_a" default="0.0"/>
  <arg name="move_forward_only" default="false"/>
  <arg name="default_rviz" value="true" unless="$(arg use_existing_path)"/>
  <arg name="default_rviz" value="false" if="$(arg use_existing_path)"/>

  <!-- bringup the turtlebot in gazebo -->
  <include file="$(find turtlebot3_gazebo)/launch/turtlebot3_world.launch" />


  <!-- navigation: robot model + amcl + move base -->
  <include file="$(find turtlebot3_navigation)/launch/turtlebot3_navigation.launch">
    <arg name="map_file" value="$(arg map_file)"/>
    <arg name="open_rviz" value="$(arg default_rviz)"/>
    <arg name="move_forward_only" value="$(arg move_forward_only)"/>
  </include>
  <param name="/move_base/DWAPlannerROS/yaw_goal_tolerance" value="10.0" />
  <param name="/move_base/DWAPlannerROS/xy_goal_tolerance" value="0.1" />
  <param name="/amcl/initial_pose_x" value="$(arg initial_pose_x)" />
  <param name="/amcl/initial_pose_y" value="$(arg initial_pose_y)" />
  <param name="/amcl/initial_pose_a" value="$(arg initial_pose_a)" />

  <group if="$(arg use_existing_path)">
    <param name="/move_base/base_global_planner" value="navfn/ExistingPathGlobalPlanner" />
    <param name="/move_base/DWAPlannerROS/occdist_scale" value="0.02" /> <!--0.05 will be stuck in the goal position when goal is surrounded by obstacle  -->
    <param name="/move_base/DWAPlannerROS/path_distance_bias" value="100" /> <!-- default value (32) is too small  -->

    <!-- Map server for existing path -->
    <node pkg="map_server" name="map_server_for_existing_path" type="map_server" args="$(arg path_file)" launch-prefix="bash -c 'sleep 5; $0 $@' ">
      <remap from = "/map" to = "/path_map" />
    </node>

  <node pkg="rviz" type="rviz" name="rviz" args="-d $(find agv_explore)/config/existing_path_global_planner.rviz" />
  </group>

  <!-- uav -->
  <include file="$(find mini_quadrotor)/launch/bringup.launch">
    <arg name="rm" value="false"/>
    <arg name="sim" value="true"/>
    <arg name="launch_gazebo" value="false"/>
    <arg name="spawn_y" value="-2.0"/>
  </include>
  <node pkg="tf" type="static_transform_publisher" name="map_uav_broadcaster" args="0 0 0 0 0 0 1 map world 20" />


</launch>
